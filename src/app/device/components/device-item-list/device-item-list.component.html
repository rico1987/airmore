<div class="airmore-device-item-list" #itemListContainer>
  <div class="airmore-device-item-list__container" *ngIf="!deviceStateService.loading">

    <!-- pictures start -->
    <div class="airmore-device-item-list__container-pictures" *ngIf="deviceStateService.activeFunction === 'pictures'" >
      <!-- cdk-virtual-scroll start -->
      <!-- documents: https://material.angular.io/cdk/scrolling/overview -->
      <cdk-virtual-scroll-viewport itemSize="5" class="virtual-scroll-viewport">
        <app-device-item-group *cdkVirtualFor="let group of deviceStateService.itemGroupList" [group]="group"></app-device-item-group>
      </cdk-virtual-scroll-viewport>
      <!-- cdk-virtual-scroll end -->
    </div>
    <!-- pictures end -->

    <!-- videos start -->
    <div class="airmore-device-item-list__container-videos" *ngIf="deviceStateService.activeFunction === 'videos'" >
      <app-device-item *ngFor="let item of deviceStateService.itemList" [item]="item"></app-device-item>
    </div>
    <!-- videos end -->

    <!-- apps start -->
    <div class="airmore-device-item-list__container-apps" *ngIf="deviceStateService.activeFunction === 'apps'">
      <app-device-item *ngFor="let item of deviceStateService.itemList" [item]="item"></app-device-item>
    </div>
    <!-- apps end -->

    <!-- documents start -->
    <div class="airmore-device-item-list__container-docs" *ngIf="deviceStateService.activeFunction === 'documents'">
        <nz-table
        *ngIf="deviceStateService.itemList && deviceStateService.activeFunction === 'documents'"
        #virtualTable
        #rowSelectionTable
        nzVirtualScroll
        [nzVirtualItemSize]="50"
        [nzData]="listOfDisplayData"
        [nzFrontPagination]="false"
        [nzShowPagination]="false"
        [nzScroll]="{ y: scrollHeight + 'px' }"
      >
        <thead>
          <tr>
            <th
              nzShowCheckbox
              nzWidth="60px"
              [(nzChecked)]="isAllDisplayDataChecked"
              (nzCheckedChange)="checkAll($event)"
            ></th>
            <th
              nzWidth="350px"
              nzShowSort
              nzSortKey="ShowName"
            >Name</th>
            <th
              nzWidth="150px"
            >Type</th>
            <th
              nzWidth="150px"
              nzShowSort
              nzSortKey="Size"
            >Size</th>
            <th
              nzShowSort
              nzSortKey="ModifyTime"
            >Modify time</th>
          </tr>
        </thead>
        <tbody>
          <ng-template nz-virtual-scroll let-data let-index="index">
            <tr>
              <td
                style="width: 60px;"
                nzShowCheckbox
                [nzChecked]="deviceStateService.hasItem(data)"
                (nzCheckedChange)="onTdCheckedChange($event, data)"
              ></td>
              <td style="width: 350px;" class="airmore-device-item-list__td">
                {{ data.ShowName }}
                <div class="airmore-device-item-list__td-operations">
                  <span class="export" (click)="export(data)"></span>
                  <span class="delete" (click)="delete(data)"></span>
                </div>
              </td>
              <td style="width: 150px;">{{ data.Path | fileType }}</td>
              <td style="width: 150px;">{{ data.Size | size }}</td>
              <td>{{ data.ModifyTime * 1000 | time }}</td>
            </tr>
          </ng-template>
        </tbody>
      </nz-table> 
    </div>
    <!-- documents end-->

    <!-- musics start -->
    <div class="airmore-device-item-list__container-musics" *ngIf="!deviceStateService.loading && deviceStateService.activeFunction === 'musics'">
      <nz-table
        *ngIf="deviceStateService.itemList && deviceStateService.activeFunction === 'musics'"
        #virtualTable
        #rowSelectionTable
        nzVirtualScroll
        [nzVirtualItemSize]="50"
        [nzData]="listOfDisplayData"
        [nzFrontPagination]="false"
        [nzShowPagination]="false"
        [nzScroll]="{ y: scrollHeight + 'px' }"
      >
        <thead>
          <tr>
            <th
              nzShowCheckbox
              nzWidth="60px"
              [(nzChecked)]="isAllDisplayDataChecked"
              (nzCheckedChange)="checkAll($event)"
            ></th>
            <th
              nzWidth="350px"
              nzShowSort
              nzSortKey="ShowName"
            >Name</th>
            <th
              nzWidth="150px"
              nzShowSort
              nzSortKey="Artist"
            >Artist</th>
            <th
              nzWidth="150px"
              nzShowSort
              nzSortKey="Album"
            >Album</th>
            <th
              nzWidth="150px"
              nzShowSort
              nzSortKey="Duration"
            >Duration</th>
            <th
              nzWidth="150px"
              nzShowSort
              nzSortKey="Size"
            >Size</th>
          </tr>
        </thead>
        <tbody>
          <ng-template nz-virtual-scroll let-data let-index="index">
            <tr>
              <td
                nzShowCheckbox
                [nzChecked]="deviceStateService.hasItem(data)"
                (nzCheckedChange)="onTdCheckedChange($event, data)"
              ></td>
              <td class="airmore-device-item-list__td">{{ data.ShowName }}</td>
              <td>{{ data.Artist || '-' }}</td>
              <td>{{ data.Album || '-' }}</td>
              <td>{{ data.Duration | duration }}</td>
              <td>{{ data.Size | size }}</td>
            </tr>
          </ng-template>
        </tbody>
      </nz-table> 
      <app-music-player></app-music-player>
    </div>
    <!-- musics end -->

    <!-- clipboard start -->
    <div class="airmore-device-item-list__container-clipboard" *ngIf="deviceStateService.activeFunction === 'clipboard'">
      <div class="toolbar">
        <span (click)="cancelClipboardEdit()" *ngIf="isClipboardEditing">Cancel</span>
        <span class="primary" (click)="saveToClipboard()" *ngIf="isClipboardEditing" [class.active]="clipboardValue">Save to clipboard</span>
      </div>
      <textarea *ngIf="isClipboardEditing" #clipboardInput [(ngModel)]="clipboardValue" placeholder="{{clipboardTextareaPlaceholder}}" [readonly]="!isClipboardEditing"></textarea>
      <p *ngIf="!isClipboardEditing && deviceStateService.activeItem && deviceStateService.activeItem['Content']">{{deviceStateService.activeItem['Content']}}</p>
    </div>
    <!-- clipboard end -->

    <!-- messages start -->
    <div class="airmore-device-item-list__container-message" *ngIf="deviceStateService.activeFunction === 'messages'">
      <div class="toolbar">
        <span class="to">To: {{deviceStateService.activeItem.ShowName}}
          <span *ngIf="deviceStateService.activeItem.Phone && deviceStateService.activeItem.Phone !== deviceStateService.activeItem.ShowName">({{deviceStateService.activeItem.Phone}})</span>
        </span>
        <span class="btn">添加为联系人</span>
        <span class="btn">查看联系人</span>
        <span class="btn">拨打电话</span>
      </div>
      <div class="content">
        <div class="message" *ngFor="let item of deviceStateService.itemList" [class.is-from-me]="item.MsgType === 2">
          <div class="date">{{item.Date}}</div>
          <div class="copy-btn" (click)="copyToClipboard(item, $event)">复制</div>
          <div class="text">{{item.Content}}</div>
        </div>
      </div>
      <div class="message-sender">
        <textarea placeholder="Ctrl + Enter 发送"></textarea>
        <div class="send-message"></div>
      </div>
    </div>
    <!-- messages end -->

    <!-- files start -->
    <nz-table
      *ngIf="deviceStateService.itemList && deviceStateService.activeFunction === 'files'"
      #virtualTable
      #rowSelectionTable
      nzVirtualScroll
      [nzVirtualItemSize]="50"
      [nzData]="listOfDisplayData"
      [nzFrontPagination]="false"
      [nzShowPagination]="false"
      [nzScroll]="{ y: scrollHeight + 'px' }"
    >
      <thead>
        <tr>
          <th
            nzShowCheckbox
            nzWidth="60px"
            [(nzChecked)]="isAllDisplayDataChecked"
            (nzCheckedChange)="checkAll($event)"
          ></th>
          <th
            nzWidth="350px"
            nzShowSort
            nzSortKey="ShowName"
          >Name</th>
          <th
            nzWidth="150px"
            nzShowSort
            nzSortKey="FileType"
          >FileType</th>
          <th
            nzWidth="150px"
            nzShowSort
            nzSortKey="Size"
          >Size</th>
          <th
            nzWidth="150px"
            nzShowSort
            nzSortKey="ModifyTime"
          >ModifyTime</th>
        </tr>
      </thead>
      <tbody>
        <ng-template nz-virtual-scroll let-data let-index="index">
          <tr>
            <td
              nzShowCheckbox
              [nzChecked]="deviceStateService.hasItem(data)"
              (nzCheckedChange)="onTdCheckedChange($event, data)"
            ></td>
            <td class="airmore-device-item-list__td" style="position: relative;">
              <i nz-icon [type]="'folder'" *ngIf="data.FileType === 2"></i>
              <i nz-icon [type]="'file'" *ngIf="data.FileType === 1"></i>
              {{ data.ShowName }}
              <div class="airmore-device-item-list__td-operations">
                <span class="export" (click)="export(data)"></span>
                <span class="delete" (click)="delete(data)"></span>
              </div>
            </td>
            <td>{{ data.FileType | isFolder }}</td>
            <td>{{ data.Size | size }}</td>
            <td>{{ data.ModifyTime | time }}</td>
          </tr>
        </ng-template>
      </tbody>
    </nz-table> 
    <!-- files end -->
  </div>
  <div class="airmore-device-item-list__no-item" *ngIf="!deviceStateService.loading && (!deviceStateService.itemList || deviceStateService.itemList.length === 0)">
      <p>The folder is empty!</p>
  </div>
</div>