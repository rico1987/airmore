<div class="airmore-device-item-list" #itemListContainer [class.is-uploading]="deviceStateService.uploadQueue.length > 0">
  <div class="airmore-device-item-list__container" *ngIf="!deviceStateService.loading">

    <!-- pictures start -->
    <div class="airmore-device-item-list__container-pictures" *ngIf="deviceStateService.activeFunction === 'pictures'" >
      <!-- cdk-virtual-scroll start -->
      <!-- documents: https://material.angular.io/cdk/scrolling/overview -->
      <cdk-virtual-scroll-viewport itemSize="5" class="virtual-scroll-viewport">
        <app-device-item-group *cdkVirtualFor="let group of deviceStateService.itemGroupList" [group]="group"></app-device-item-group>
      </cdk-virtual-scroll-viewport>
      <!-- cdk-virtual-scroll end -->
    </div>
    <!-- pictures end -->

    <!-- videos start -->
    <div class="airmore-device-item-list__container-videos" *ngIf="deviceStateService.activeFunction === 'videos'" >
      <app-device-item *ngFor="let item of deviceStateService.itemList" [item]="item"></app-device-item>
    </div>
    <!-- videos end -->

    <!-- apps start -->
    <div class="airmore-device-item-list__container-apps" *ngIf="deviceStateService.activeFunction === 'apps'">
      <app-device-item *ngFor="let item of deviceStateService.itemList" [item]="item"></app-device-item>
    </div>
    <!-- apps end -->

    <!-- documents start -->
    <div class="airmore-device-item-list__container-docs" *ngIf="deviceStateService.activeFunction === 'documents'">
        <nz-table
        *ngIf="deviceStateService.itemList && deviceStateService.activeFunction === 'documents'"
        #virtualTable
        #rowSelectionTable
        nzVirtualScroll
        [nzVirtualItemSize]="50"
        [nzData]="listOfDisplayData"
        [nzFrontPagination]="false"
        [nzShowPagination]="false"
        [nzScroll]="{ y: scrollHeight + 'px' }"
      >
        <thead>
          <tr>
            <th
              nzShowCheckbox
              nzWidth="40px"
              [(nzChecked)]="isAllDisplayDataChecked"
              (nzCheckedChange)="checkAll($event)"
            ></th>
            <th
              nzShowSort
              nzSortKey="ShowName"
            >Name</th>
            <th
              nzWidth="150px"
            >Type</th>
            <th
              nzWidth="150px"
              nzShowSort
              nzSortKey="Size"
            >Size</th>
            <th
              nzWidth="150px"
              nzShowSort
              nzSortKey="ModifyTime"
            >Modify time</th>
          </tr>
        </thead>
        <tbody>
          <ng-template nz-virtual-scroll let-data let-index="index">
            <tr>
              <td
                style="width: 40px;"
                nzShowCheckbox
                [nzChecked]="deviceStateService.hasItem(data)"
                (nzCheckedChange)="onTdCheckedChange($event, data)"
              ></td>
              <td class="airmore-device-item-list__td">
                <span class="file-icon" [ngClass]="data.album"></span>
                <span class="name">{{ data.ShowName }}</span>
                <div class="airmore-device-item-list__td-operations">
                  <span class="export" (click)="export(data)"></span>
                  <span class="delete" (click)="delete(data)"></span>
                </div>
              </td>
              <td style="width: 150px;">{{ data.Path | fileType }}</td>
              <td style="width: 150px;">{{ data.Size | size }}</td>
              <td style="width: 150px;">{{ data.ModifyTime * 1000 | time }}</td>
            </tr>
          </ng-template>
        </tbody>
      </nz-table> 
    </div>
    <!-- documents end-->

    <!-- musics start -->
    <div class="airmore-device-item-list__container-musics" *ngIf="!deviceStateService.loading && deviceStateService.activeFunction === 'musics'">
      <nz-table
        *ngIf="deviceStateService.itemList && deviceStateService.activeFunction === 'musics'"
        #virtualTable
        #rowSelectionTable
        nzVirtualScroll
        [nzVirtualItemSize]="50"
        [nzData]="listOfDisplayData"
        [nzFrontPagination]="false"
        [nzShowPagination]="false"
        [nzScroll]="{ y: scrollHeight + 'px' }"
      >
        <thead>
          <tr>
            <th
              nzShowCheckbox
              nzWidth="40px"
              [(nzChecked)]="isAllDisplayDataChecked"
              (nzCheckedChange)="checkAll($event)"
            ></th>
            <th
              nzShowSort
              nzSortKey="ShowName"
            >Name</th>
            <th
              nzWidth="250px"
              nzShowSort
              nzSortKey="Artist"
            >Artist</th>
            <th
              nzWidth="250px"
              nzShowSort
              nzSortKey="Album"
            >Album</th>
            <th
              nzWidth="100px"
              nzShowSort
              nzSortKey="Duration"
            >Duration</th>
            <th
              nzWidth="100px"
              nzShowSort
              nzSortKey="Size"
            >Size</th>
          </tr>
        </thead>
        <tbody>
          <ng-template nz-virtual-scroll let-data let-index="index">
            <tr>
              <td
                style="width: 40px;"
                nzShowCheckbox
                [nzChecked]="deviceStateService.hasItem(data)"
                (nzCheckedChange)="onTdCheckedChange($event, data)"
              ></td>
              <td class="airmore-device-item-list__td">
                {{ data.ShowName }}
                <div class="airmore-device-item-list__td-operations">
                    <span class="play" (click)="playMusic(data)"></span>
                    <span class="export" (click)="export(data)"></span>
                    <span class="delete" (click)="delete(data)"></span>
                </div>
              </td>
              <td style="width: 250px;">{{ data.Artist | cutOff }}</td>
              <td style="width: 250px;">{{ data.Album | cutOff }}</td>
              <td style="width: 100px;">{{ data.Duration / 1000 | duration }}</td>
              <td style="width: 100px;">{{ data.Size | size }}</td>
            </tr>
          </ng-template>
        </tbody>
      </nz-table> 
      <app-music-player #musicPlayer [playList]="deviceStateService.itemList" class="airmore-device-item-list__music-player"></app-music-player>
    </div>
    <!-- musics end -->

    <!-- clipboard start -->
    <div class="airmore-device-item-list__container-clipboard" *ngIf="deviceStateService.activeFunction === 'clipboard'">
      <div class="toolbar">
        <span class="cancel" (click)="cancelClipboardEdit()" *ngIf="isClipboardEditing">Cancel</span>
        <span class="primary" (click)="saveToClipboard()" *ngIf="isClipboardEditing" [class.active]="clipboardValue">Save to clipboard</span>
      </div>
      <textarea (keydown)="onKeyDown($event)" *ngIf="isClipboardEditing" #clipboardInput [(ngModel)]="clipboardValue" placeholder="{{clipboardTextareaPlaceholder}}" [readonly]="!isClipboardEditing"></textarea>
      <p *ngIf="!isClipboardEditing && deviceStateService.activeItem && deviceStateService.activeItem['Content']">{{deviceStateService.activeItem['Content']}}</p>
    </div>
    <!-- clipboard end -->

    <!-- messages start -->
    <div class="airmore-device-item-list__container-message" *ngIf="deviceStateService.activeFunction === 'messages' && !deviceStateService.isAddingMessage">
      <div class="toolbar">
        <span class="to">To: {{deviceStateService.activeItem.ShowName}}
          <span *ngIf="deviceStateService.activeItem.Phone && deviceStateService.activeItem.Phone !== deviceStateService.activeItem.ShowName">({{deviceStateService.activeItem.Phone}})</span>
        </span>
        <span class="btn" (click)="call()">拨打电话</span>
        <span class="btn" (click)="checkContact()">查看联系人</span>
        <span class="btn" (click)="addToContact()">添加为联系人</span>
      </div>
      <div class="content" #messageContent>
        <div class="message" *ngFor="let item of deviceStateService.itemList" [class.is-received]="item.MsgType === 1" [class.is-from-me]="item.MsgType === 2">
          <div class="date">{{item.Date}}</div>
          <div class="copy-btn" (click)="copyToClipboard(item, $event)">复制</div>
          <div class="text">{{item.Content}}</div>
        </div>
      </div>
      <div class="message-sender">
        <textarea (keydown)="onMessageContentKeyDown($event)" placeholder="{{messageTextareaPlaceholder}}" [(ngModel)]="messageValue"></textarea>
        <div class="send-message" (click)="sendMessage()" [class.is-active]="messageValue"></div>
      </div>
    </div>
    <div class="airmore-device-item-list__container-message" *ngIf="deviceStateService.activeFunction === 'messages' && deviceStateService.isAddingMessage">
        <div class="toolbar">
          <span class="to">
            <span class="label">To:</span>
            <span class="contact" *ngFor="let contact of deviceStateService.selectedMessageReceivers">
              {{contact['Name']['DisplayName']}}
              <i (click)="removeFormReceivers(contact)">─</i>
            </span>
            <input type="text" autofocus (keyup)="onContactKey($event)" maxlength="50" />
          </span>
          <span #addContactBtn class="add-contact" (click)="showContactSelector($event)"></span>
        </div>
        <div class="message-sender">
          <textarea (keydown)="onMessageContentKeyDown($event)" placeholder="{{messageTextareaPlaceholder}}" [(ngModel)]="messageValue"></textarea>
          <div class="send-message" (click)="sendMessage()" [class.is-active]="messageValue"></div>
        </div>
      </div>
    <!-- messages end -->

    <!-- files start -->
    <div class="airmore-device-item-list__container-files" *ngIf="deviceStateService.activeFunction === 'files'">
      <nz-table
        *ngIf="deviceStateService.itemList && deviceStateService.activeFunction === 'files'"
        #virtualTable
        #rowSelectionTable
        nzVirtualScroll
        [nzVirtualItemSize]="50"
        [nzData]="listOfDisplayData"
        [nzFrontPagination]="false"
        [nzShowPagination]="false"
        [nzScroll]="{ y: scrollHeight + 'px' }"
      >
        <thead>
          <tr>
            <th
              nzShowCheckbox
              nzWidth="40px"
              [(nzChecked)]="isAllDisplayDataChecked"
              (nzCheckedChange)="checkAll($event)"
            ></th>
            <th
              nzShowSort
              nzSortKey="ShowName"
            >Name</th>
            <th
              nzWidth="150px"
              nzShowSort
              nzSortKey="FileType"
            >FileType</th>
            <th
              nzWidth="150px"
              nzShowSort
              nzSortKey="Size"
            >Size</th>
            <th
              nzWidth="150px"
              nzShowSort
              nzSortKey="ModifyTime"
            >ModifyTime</th>
          </tr>
        </thead>
        <tbody>
          <ng-template nz-virtual-scroll let-data let-index="index">
            <tr>
              <td
                style="width: 40px;"
                nzShowCheckbox
                [nzChecked]="deviceStateService.hasItem(data)"
                (nzCheckedChange)="onTdCheckedChange($event, data)"
              ></td>
              <td class="airmore-device-item-list__td">
                <span class="icon" [class.is-file]="data.FileType === 1" [class.is-folder]="data.FileType === 2"></span>
                {{ data.ShowName }}
                <div class="airmore-device-item-list__td-operations">
                  <span class="export" (click)="export(data)"></span>
                  <span class="delete" (click)="delete(data)"></span>
                </div>
              </td>
              <td style="width: 150px;">{{ data.FileType | isFolder }}</td>
              <td style="width: 150px;">{{ data.Size | size }}</td>
              <td style="width: 150px;">{{ data.ModifyTime | time }}</td>
            </tr>
          </ng-template>
        </tbody>
      </nz-table>
    </div>
    <!-- files end -->

    <!-- contacts start -->
    <div class="airmore-device-item-list__container-contact" *ngIf="deviceStateService.activeFunction === 'contacts' && !deviceStateService.loading">
      <div class="airmore-device-item-list__container-header">
        <div class="checkbox" [class.is-checked]="isAllSelected" (click)="selectAllContacts()"></div>
        <span>名称 {{deviceStateService.selectedItems.length}} / {{contactsCount}}</span>
      </div>
      <div class="airmore-device-item-list__contact-list" *ngIf="deviceStateService.contactLetterGroupList">
        <div class="container" #contactGroupContainer>
          <div
            class="group-item"
            *ngFor="let item of deviceStateService.contactLetterGroupList"
          >
              <app-contact-letter-group
              [ngClass]="'letter-' + item['key']"
              *ngIf="item['contacts'].length > 0"
              [item]="item"
            ></app-contact-letter-group>
          </div>
        </div>
       
        <div class="contact-letters">
          <div *ngFor="let letter of allLetters" (click)="scrollToLetter(letter)"><div>{{letter}}</div></div>
        </div>
      </div>
      <div class="airmore-device-item-list__contact-detail">
        <app-contact-detail #contactDetail *ngIf="deviceStateService.activeContact" [contact]="deviceStateService.activeContact"></app-contact-detail>
      </div>
    </div>
    <!-- contacts end -->
  </div>
  <!-- <div class="airmore-device-item-list__no-item" *ngIf="!deviceStateService.loading && (!deviceStateService.itemList || deviceStateService.itemList.length === 0)">
      <p>The folder is empty!</p>
  </div> -->
</div>